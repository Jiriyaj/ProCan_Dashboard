<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ProCan J.A.I.D.A — Ops Console</title>
  <link rel="stylesheet" href="./styles.css?v=20260129-1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="icon" href="data:,">
</head>
<body>

  <!-- Startup -->
  <div class="startup-overlay" id="startupOverlay" aria-hidden="true">
    <div class="startup-logo">ProCan J.A.I.D.A</div>
    <div class="startup-text">Initializing ops console…</div>
    <div class="startup-spinner" aria-hidden="true"></div>
  </div>

  <!-- AUTH -->
  <div class="auth-gate" id="authGate" style="display:none;">
    <div class="auth-card">
      <div class="auth-brand">ProCan J.A.I.D.A</div>
      <div class="auth-sub">Secure login</div>

      <label class="field">
        <span>Email</span>
        <input id="authEmail" type="email" placeholder="you@procan.com" autocomplete="email" />
      </label>

      <label class="field">
        <span>Password</span>
        <input id="authPassword" type="password" placeholder="••••••••" autocomplete="current-password" />
      </label>

      <div class="auth-actions">
        <button class="btn primary" id="btnLogin">Login</button>
        <button class="btn ghost" id="btnMagic">Send magic link</button>
      </div>

      <div class="auth-msg" id="authMsg"></div>
      <div class="auth-foot">Authorized staff only</div>
    </div>
  </div>

  <!-- APP SHELL -->
  <div class="app" id="app" style="display:none;">
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-title">ProCan J.A.I.D.A</div>
        <div class="brand-sub">Dispatch • Routes • Payouts</div>
      </div>

      <nav class="nav">
        <button class="nav-item active" data-view="homeView">Home</button>
        <button class="nav-item" data-view="scheduleView">Schedule</button>
        <button class="nav-item" data-view="mapView">Map</button>
        <button class="nav-item" data-view="ordersView">Orders</button>
        <button class="nav-item" data-view="operatorsView">Operators</button>
      </nav>

      <div class="sidebar-foot">
        <div class="pill" id="signedInPill">Signed in</div>
        <button class="btn outline" id="btnLogout">Logout</button>
      </div>
    </aside>

    <main class="main">
      <header class="topbar">
        <div>
          <div class="page-title" id="pageTitle">Home</div>
          <div class="page-sub" id="pageSub">At-a-glance ops overview</div>
        </div>

        <div class="topbar-actions">
          <div class="datebox">
            <label>Week</label>
            <input type="date" id="weekPicker" />
          </div>
          <button class="btn ghost" id="btnRefresh">Refresh</button>
          <button class="btn primary" id="btnAutoAssign">Generate schedule</button>
        </div>
      </header>

      <div class="banner warn" id="banner" style="display:none;"></div>

      <!-- HOME -->
      <section class="view" id="homeView">
        <div class="grid kpis">
          <div class="card kpi">
            <div class="kpi-label">This week gross</div>
            <div class="kpi-value" id="kpiGross">$0</div>
            <div class="kpi-sub" id="kpiGrossSub">From scheduled work</div>
          </div>
          <div class="card kpi">
            <div class="kpi-label">This week profit</div>
            <div class="kpi-value" id="kpiProfit">$0</div>
            <div class="kpi-sub">Gross − operator payouts</div>
          </div>
          <div class="card kpi">
            <div class="kpi-label">Jobs this week</div>
            <div class="kpi-value" id="kpiJobs">0</div>
            <div class="kpi-sub">Scheduled assignments</div>
          </div>
          <div class="card kpi">
            <div class="kpi-label">Operator payouts</div>
            <div class="kpi-value" id="kpiPayouts">$0</div>
            <div class="kpi-sub">Due end of pay period</div>
          </div>
        </div>

        <div class="grid two">
          <div class="card">
            <div class="card-head">
              <div>
                <div class="card-title">Intake orders</div>
                <div class="card-sub">All orders from the Intake form (grouped by cadence • area • age to help build routes)</div>
              </div>
              <div class="filters">
                <select id="homeCadence"></select>
                <select id="homeAge"></select>
                <input id="homeSearch" type="search" placeholder="Search business / address…" />
                <button class="btn ghost" id="btnGoOrdersHome">Open full orders</button>
              </div>
            </div>
            <div class="chips" id="homeGroupChips"></div>
            <div class="table" id="homeOrdersTable"></div>
          </div>

          <div class="card">
            <div class="card-head">
              <div>
                <div class="card-title">Soonest available</div>
                <div class="card-sub">Quick availability check for mid-sale</div>
              </div>
              <button class="btn ghost" id="btnGoSchedule2">Open schedule</button>
            </div>
            <div class="divider"></div>
            <div class="workload">
              <div class="workload-title">Next open service day</div>
              <div class="kpi-value" id="nextAvailable">—</div>
              <div class="kpi-sub" id="nextAvailableSub">Based on current scheduled workload</div>
              <div class="divider"></div>
              <div class="workload-title">Weekly workload</div>
              <div class="workload-bar"><div class="workload-fill" id="workloadFill"></div></div>
              <div class="workload-sub" id="workloadSub">—</div>
            </div>
          </div>
        </div>

      </section>

<!-- SCHEDULE -->
      <section class="view" id="scheduleView" style="display:none;">
        <div class="card">
          <div class="card-head">
            <div>
              <div class="card-title">Schedule</div>
              <div class="card-sub">Weekly dispatch list. Assign/reassign and edit jobs.</div>
            </div>
            <div class="filters">
              <select id="filterOperator"></select>
              <select id="filterRange"></select>
              <button class="btn ghost" id="btnPrintSchedule">Print PDF</button>
            </div>
          </div>
          <div class="schedule" id="scheduleBoard"></div>
        </div>
      </section>

      <!-- MAP -->
      <section class="view" id="mapView" style="display:none;">
        <div class="card">
          <div class="card-head">
            <div>
              <div class="card-title">Orders map</div>
              <div class="card-sub">All intake orders shown as location markers.</div>
            </div>
            <div class="filters">
              <select id="mapCadence"></select>
              <select id="mapStatus"></select>
              <button class="btn ghost" id="btnGeocodeMissing">Geocode missing</button>
            </div>
          </div>
          <div class="map-wrap">
            <div id="map"></div>
            <div class="map-empty" id="mapEmpty" style="display:none;">
              <div class="map-empty-title">No mappable orders yet</div>
              <div class="map-empty-sub">Geocode missing addresses to view all intake orders on the map.</div>
              <div class="map-empty-actions">
                <button class="btn primary" id="btnGoOrdersMap">Open orders</button>
                <button class="btn ghost" id="btnGeocode2">Geocode missing</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ORDERS -->
      <section class="view" id="ordersView" style="display:none;">
        <div class="card">
          <div class="card-head">
            <div>
              <div class="card-title">Orders</div>
              <div class="card-sub">Incoming orders from Intake form (auto scheduled).</div>
            </div>
            <div class="filters">
              <select id="ordersStatus"></select>
              <input id="ordersSearch" type="search" placeholder="Search business / address…" />
              <button class="btn ghost" id="btnBulkAutoAssign">Generate schedule</button>
            </div>
          </div>
          <div class="table" id="ordersTable"></div>
        </div>
      </section>

      <!-- OPERATORS -->
      <section class="view" id="operatorsView" style="display:none;">
        <div class="card">
          <div class="card-head">
            <div>
              <div class="card-title">Operators</div>
              <div class="card-sub">Manage payouts & capacity.</div>
            </div>
            <button class="btn primary" id="btnAddOperator">Add operator</button>
          </div>

          <div class="grid three">
            <div class="card inner">
              <div class="card-title-sm">Operators</div>
              <div class="list" id="operatorsList"></div>
            </div>
            <div class="card inner">
              <div class="card-title-sm">Edit</div>
              <div id="operatorEditor" class="muted">Select an operator…</div>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="./supabase-config.js?v=20260129-1"></script>
  <script src="./script.js?v=20260129-1"></script>
</body>
</html>
