<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ProCan J.A.I.D.A — Ops & Payout Tracker</title>
  <link rel="stylesheet" href="./styles.css?v=20260127-3" />
  <!-- Leaflet (map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="icon" href="data:,">
</head>
<body>
  

<script>
  // Remove startup overlay ASAP (cannot be blocked by later JS errors)
  window.addEventListener('DOMContentLoaded', function(){
    var o = document.getElementById('startupOverlay');
    if (o){
      o.classList.add('hidden');
      setTimeout(function(){ try{o.remove();}catch(e){} }, 300);
    }
  });
</script>

<!-- Startup Sequence -->
  <div class="startup-overlay" id="startupOverlay" aria-hidden="true" style="position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10000;">
    <div class="startup-logo">ProCan J.A.I.D.A</div>
    <div class="startup-text">J.A.I.D.A, initializing ops console…</div>
    <div class="startup-spinner" aria-hidden="true"></div>
  </div>

  <div class="content-wrapper" id="contentWrapper">
    <div class="page-wrap">

      <!-- AUTH GATE -->
      <div class="auth-gate" id="authGate" style="display:none;">
        <div class="card auth-card">
          <div class="card-header">
            <h2>Secure Login</h2>
            <span class="tier-badge tier-1">Supabase Auth</span>
          </div>

          <div class="form-group">
            <label for="authEmail">Email</label>
            <input id="authEmail" type="email" placeholder="you@procan.com" autocomplete="email" />
          </div>

          <div class="form-group">
            <label for="authPassword">Password</label>
            <input id="authPassword" type="password" placeholder="••••••••" autocomplete="current-password" />
          </div>

          <div class="form-row">
            <button class="btn-primary" type="button" id="btnLogin">Login</button>
            <button class="btn-secondary" type="button" id="btnSignup">Create Account</button>
          </div>

          <div style="margin-top:12px;font-size:12px;opacity:.8;line-height:1.4;">
            Tip: create your first admin account, then keep this dashboard private.
          </div>

          <div id="authMsg" class="empty-state" style="margin-top:14px;display:none;"></div>
        </div>
      </div>

      <!-- APP -->
      <div id="appShell" style="display:none; width:100%;">
        <div class="topbar">
          <div class="topbar-left">
            <div class="topbar-title">ProCan J.A.I.D.A</div>
            <div class="topbar-sub">Ops • Operators • Payouts</div>
          </div>
          <div class="topbar-right">
            <div class="pill" id="whoamiPill">Signed in</div>
            <button class="btn-secondary btn-small" id="btnLogout" type="button">Logout</button>
          </div>
        </div>

        <div class="container">
          <!-- Single column -->
          <div class="right full">
            <div id="alertContainer"></div>

            <div class="card">
              <div class="card-header">
                <h2>Dashboard</h2>
                <div class="dashboard-header-right">
                  <div style="font-size:12px; opacity:.75;">Biweekly operator pay periods end on Friday</div>
                  <button id="wipeBtn" class="btn-secondary btn-small stealth-wipe" type="button" title="(Local only) Clear UI cache" onclick="clearLocalUiCache()">Wipe</button>
                </div>
              </div>

              <div class="summary-grid">
                <div class="summary-card">
                  <div class="summary-label">Paid Orders</div>
                  <div class="summary-value" id="kpiPaidOrders">0</div>
                </div>
                <div class="summary-card">
                  <div class="summary-label">Unassigned Orders</div>
                  <div class="summary-value" id="kpiUnassigned">0</div>
                </div>
                <div class="summary-card">
                  <div class="summary-label">Scheduled (next 7 days)</div>
                  <div class="summary-value" id="kpiScheduled">0</div>
                </div>
                <div class="summary-card">
                  <div class="summary-label">Active Operators</div>
                  <div class="summary-value" id="kpiOperators">0</div>
                </div>
              </div>

              <div class="tabs" style="margin-top: 18px;">
                <button class="tab active" onclick="switchTab('dispatch')">Dispatch</button>
                <button class="tab" onclick="switchTab('map')">Map</button>
                <button class="tab" onclick="switchTab('leads')">Leads</button>
                <button class="tab" onclick="switchTab('orders')">Orders</button>
                <button class="tab" onclick="switchTab('routes')">Routes</button>
                <button class="tab" onclick="switchTab('operators')">Operators</button>
                              </div>

              <div class="tab-content active" id="dispatchTab">
                <div id="dispatchPanel"></div>
              </div>

              <div class="tab-content" id="mapTab">
                <div id="mapPanel"></div>
              </div>

              <div class="tab-content" id="leadsTab">
                <div id="leadsPanel"></div>
              </div>

              <div class="tab-content" id="ordersTab">
                <div id="ordersPanel"></div>
              </div>
              
              <div class="tab-content" id="routesTab">
                <div id="routesPanel"></div>
              </div>

              <div class="tab-content" id="operatorsTab">
                <div class="card">
              <div class="card-header">
                <h2>Operators</h2>
                <button class="btn-secondary" type="button" onclick="toggleRepForm()">Add / Edit</button>
              </div>

              <div id="repForm" style="display:none;">
                <div class="form-row">
                  <div class="form-group">
                    <label for="repName">Operator Name</label>
                    <input id="repName" type="text" placeholder="e.g., Chris" />
                  </div>
                  <div class="form-group">
                    <label for="repChurn">Payout %</label>
                    <input id="repChurn" type="number" min="0" max="100" step="0.1" placeholder="30" />
                  </div>
                </div>
                <div class="form-group">
                  <label style="display:flex;gap:10px;align-items:center;">
                    <input id="repIsManager" type="checkbox" style="width:auto;">
                    <span>Lead / Supervisor</span>
                  </label>
                </div>
                <div class="form-row">
                  <button class="btn-primary" type="button" onclick="addRep()">Save Operator</button>
                  <button class="btn-secondary" type="button" onclick="toggleRepForm()">Close</button>
                </div>
              </div>

              <div id="repsList"></div>
            </div>
              </div>


              </div>              


            </div>
          </div>
        </div>
      </div> <!-- /appShell -->
    </div>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="./supabase-config.js"></script>
  <script defer  defer src="./script.js?v=20260127-3"></script>
</body>
</html>
